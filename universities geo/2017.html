<!DOCTYPE html>
<html xmlns="//www.w3.org/1999/xhtml">

<head>
	<meta charset="utf-8">
	<meta http-equiv="content-Type" content="text/html; charset=utf-8" />
    <meta name="description" content="The global center of mass of higher education: university rankings mapped #education #arwu #d3js @csaladenes" />
    <meta name="keywords" content="center of mass, center of gravity, geocenter, csaladenes, d3.js, d3, university, rankings, infographic, data visualization" />
	<meta property="og:image" content="snapshot.png" />
    <meta property="og:description" content="The global center of mass of higher education: university rankings mapped #education #arwu #d3js @csaladenes" />
    <meta property="og:title" content="The global center of mass of higher education: university rankings mapped" />
    <meta property="og:type" content="article" />
    <meta property="og:site_name" content="blog.csaladen.es" />
    <meta property="fb:admins" content="100943737036023614165" />
    <title>The global center of mass of higher education: university rankings mapped</title>
<style>
html,
        body {
            font-family: "Trebuchet MS", "Open Sans", Segoe UI light, Verdana, Tahoma, Helvetica, sans-serif;
            margin: 0;
            padding: 0;
            overflow: hidden;
            height: 100%;
            width: 100%;
        }
.background {
  fill: #444;
  pointer-events: all;
}

.feature{
  fill: #99d8c9;
  cursor: pointer;
}

.feature.active {
  fill: #777;
}
.feature:hover {
  fill: #777;
}

.mesh {
  fill: none;
  stroke: #444;
  stroke-linecap: round;
  stroke-linejoin: round;
}
.graticule {
            fill: none;
            stroke: #000;
            stroke-opacity: .3;
            stroke-width: .5px;
        }
        .graticule.outline {
            stroke: #333;
            stroke-opacity: 1;
            stroke-width: 1.5px;
        }
        div.tooltip {
            line-height: 1;
            font-weight: bold;
            font-size: 12px;
            padding: 6px;
            background: rgba(255, 255, 255, 0.8);
            color: #000;
            border-radius: 4px;
            border-color: black;
            border: solid 1px;
            z-index: 2000;
            position: absolute;
        }
        .dragdealer {
            height: 18px;
            background: #555;
            z-index: 50;
        }
        .dragdealer .handle {
            top: 0;
            left: 0;
            cursor: pointer;
			z-index: 52;
        }
        .dragdealer .orange-bar {
            width: 80px;
            height: 18px;
            background: #99d8c9;
            color: #444;
            font-size: 14px;
            line-height: 19px;
            text-align: center;
            font-weight: bold;
			z-index: 52;
        }
        .dragdealer .orange-bar:hover {
            background: #777;
        }
		a {
		   text-decoration: none;
		   color:#99d8c9;
		}
		#social {
			position: fixed;
            top: 0;
            right: 0;
            text-decoration: none;
			text-align:right;
			padding: 3px;
            z-index: 800;
			white-space:nowrap;
			overflow:hidden;
			opacity:0;
        }
    </style>
	<script type="text/javascript">var switchTo5x=true;</script>
	<script type="text/javascript" src="//w.sharethis.com/button/buttons.js"></script>
	<script type="text/javascript">stLight.options({publisher: "505a26ad-d820-47bd-a500-7f49d04a30f5", doNotHash: true, doNotCopy: false, hashAddressBar: false});</script>
<body>
<div id="container" style="width:900px;height:500px;margin:0px;opacity:0;border:solid 1px #99d8c9;">
<div style="position:fixed;float:left;top:485px;left:805px;opacity:1;font-size:8px;color:#99d8c9;"><a href="//www.csaladen.es" target="_blank">csaladen.es</a> | <a href="https://twitter.com/csaladenes" target="_blank">@csaladenes</a></div>
<div style="position:fixed;float:left;top:445px;left:5px;opacity:1;"><a href="//blog.csaladen.es" target="_blank"><img style="width:50px;height:50px;border:solid 1px #99d8c9;" src="tsne.png"/></a></div>
<div style="position:fixed;float:left;top:440px;left:270px;opacity:1;font-size:24px;"><a href="//wp.me/pBH3w-82" target="_blank" style="color:#99d8c9;background:#444;"> The global center of mass of higher education </a></div>
<div id="pslider" title="Drag slider to cycle over years" class="dragdealer" style="position:fixed;float:left;top:475px;left:270px;opacity:1;width:495px;">
            <div class="description" style="position:fixed;margin-left:100px;font-size:12px;color:#777;">&laquo; drag or use arrow keys to change year&raquo;</div><div class="orange-bar" style="cursor: pointer;position:fixed;margin-left:0px;width:14px;">&lt;</div>
			<div class="orange-bar" style="cursor: pointer;position:fixed;margin-left:481px;width:14px;">&gt;</div>
			<div class="handle orange-bar" id="syear">2017</div>			
</div>
<div style="position:fixed;float:left;top:420px;left:5px;opacity:1;width:50px;height:10px;background:#5e3c99;color:#99d8c9;font-size:8px;text-align:center;line-height:10px;">401-500</div>
<div style="position:fixed;float:left;top:405px;left:5px;opacity:1;width:50px;height:10px;background:#b2abd2;color:#444;font-size:8px;text-align:center;line-height:10px;">301-400</div>
<div style="position:fixed;float:left;top:390px;left:5px;opacity:1;width:50px;height:10px;background:#f7f7f7;color:#444;font-size:8px;text-align:center;line-height:10px;">201-300</div>
<div style="position:fixed;float:left;top:375px;left:5px;opacity:1;width:50px;height:10px;background:#fdb863;color:#444;font-size:8px;text-align:center;line-height:10px;">101-200</div>
<div style="position:fixed;float:left;top:360px;left:5px;opacity:1;width:50px;height:10px;background:#e66101;color:#444;font-size:8px;text-align:center;line-height:10px;">1-100</div>
<div style="position:fixed;float:left;top:433px;left:5px;opacity:1;width:50px;height:10px;color:#99d8c9;font-size:8px;text-align:center;line-height:10px;">Ranking</div>
<div style="position:fixed;float:left;top:348px;left:5px;opacity:1;width:50px;height:10px;color:#99d8c9;font-size:8px;text-align:center;line-height:10px;">Geocenter</div>
	
<div id="social">
	<span class='st_facebook'></span>
	<span class='st_twitter'></span>
	<span class='st_googleplus'></span>
	<span class='st_linkedin'></span>
	<span class='st_tumblr'></span>
	<span class='st_reddit'></span>
	<span class='st_email'></span>
</div>
</div>

<script src="//d3js.org/d3.v3.min.js"></script>
<script src="//d3js.org/d3.geo.projection.v0.min.js"></script>
<script src="//d3js.org/topojson.v1.min.js"></script>
<script src="dragdealer.js"></script>
<script>
var colors2=["#c994c7",
"#df65b0",
"#e7298a",
"#ce1256",
"#980043",
"#67001f",
"#45000d"]
var colors3=["#a6bddb",
"#67a9cf",
"#3690c0",
"#02818a",
"#016c59",
"#014636",
"#002209"]
var colors=[
"#e66101",
"#fdb863",
"#f7f7f7",
"#b2abd2",
"#5e3c99"]
var width = document.getElementById("container").offsetWidth - 2,
    height = document.getElementById("container").offsetHeight - 2,
    active = d3.select(null);

var projection = d3.geo.naturalEarth();

var defaultZoom = 1.3;
var defaultTranslateX = -220;
var defaultTranslateY = -40;
	

var path = d3.geo.path()
    .projection(projection);

var tiptext = "no data";

var tooltipdiv = d3.select("body")
	.append("div")
	.attr("class", "tooltip")
	.style("visibility", "hidden")

var tipshow = function() {
	tooltipdiv.style("visibility", "visible");

	tooltipdiv.html(function() {
			var tt = '<table><tr><td colspan="2"  style="color:#e66101;">' + tiptext[0].name +
				'</td></tr><tr><td>Rank: </td><td>'+tiptext[0].rank+'</td></tr>'
				
			for (ii=0;ii<tiptext[1].length;ii++){
			
				var queue=true;
				if (tiptext[2][ii]==2011) {
					queue=false;
					var save=tiptext[1][ii];
					}
				if (queue)
					{tt=tt+'<tr><td>'+tiptext[2][ii]+'</td>'+'<td>'+tiptext[1][ii]+'</td></tr>';}
				if ((tiptext[2][ii]==2010)&&(queue))
					{tt=tt+'<tr><td>2011</td>'+'<td>'+save+'</td></tr>';}
			}
				
			return tt+'</table>';
		})
		.style("left", (d3.event.pageX + 30) + "px")
		.style("top", (d3.event.pageY - 30) + "px");

}
var tiphide = function() {
	tooltipdiv.style("visibility", "hidden");
}	
	
 
d3.json("u2017.json",  function(error, u) {
d3.json("v2017.json",  function(error, v) {

var svg = d3.select("#container").append("svg")
    .attr("width", width)
    .attr("height", height)
    .on("click", stopped, true);

svg.append("rect")
    .attr("class", "background")
    .attr("width", width)
    .attr("height", height)
    .on("click", reset);

var g = svg.append("g");
	
var zoom = d3.behavior.zoom()
    .translate([defaultTranslateX, defaultTranslateY])
    .scale(defaultZoom)
    .scaleExtent([defaultZoom, 100])
    .on("zoom", zoomed);

svg
    .call(zoom) // delete this line to disable free zooming
    .call(zoom.event);

d3.json("world.json", function(error, world) {
  g.selectAll("path")
      .data(topojson.feature(world, world.objects.countries).features)
    .enter().append("path")
      .attr("d", path)
      .attr("class", "feature")
      .on("click", clicked);

  g.append("path")
      .datum(topojson.mesh(world, world.objects.countries, function(a, b) { return a !== b; }))
      .attr("class", "mesh")
      .attr("d", path);
 });	
	
var yr =2003;
var scale=defaultZoom;
var translate=[defaultTranslateX, defaultTranslateY];

var update=function(year){
	
	svg.selectAll(".pin")
                .data(u[year])
				.exit().remove();
	
	svg.selectAll(".pin")
                .data(u[year])
				.enter().append("circle")
				.attr("class", "pin")
				.attr("stroke", "black")
				.style("opacity",0.8)
                .on("mouseout", tiphide);
	
	svg.selectAll(".pin")
                .attr("r",function(d){
					return (Math.sqrt(2000/Math.max(1,(d.rank.substr(0,3)-0)))+2)/scale;
				})
                .attr("cx", function(d) {
                    return (projection([v[d.name].coord[1], v[d.name].coord[0]])[0]-0)*1;
                })
                .attr("cy", function(d) {
                    return (projection([v[d.name].coord[1], v[d.name].coord[0]])[1]-0)*1;
                })
				.attr("fill", function(d){
					return colors[parseInt(d.rank.substr(0,3)/100)];
				})
				.attr("transform", "translate(" + translate + ")scale(" + scale + ")")
    			.attr("stroke-width",1/scale)
				.on("mouseover", function(d) {
                    tiptext = [d,v[d.name].ranks,v[d.name].years];
                    tipshow();
                    return;
                });
				
				center();
				d3.select("#pslider").select("#syear").text(year);

function center(){

	svg.selectAll(".geocurrent").remove();
	
	var lat = 0;
	var lon = 0;
	var su =0;
	for (var i in u[year]) {
		lat = lat + v[u[year][i].name].coord[1]*1.0/parseInt(Math.sqrt(u[year][i].rank.slice(0,3)))
		lon = lon + v[u[year][i].name].coord[0]*1.0/parseInt(Math.sqrt(u[year][i].rank.slice(0,3)))
		su = su + 1.0/parseInt(Math.sqrt(u[year][i].rank.slice(0,3)));
	}

	lat = lat / su;
	lon = lon / su;
	var xs = projection([lat, lon])[0];
	var ys = projection([lat, lon])[1];
	svg.append("polygon")
		.attr("points", xs+","+(ys+5)+" "+(xs+5/defaultZoom)+","+(ys+17/defaultZoom)+" "+(xs-5/defaultZoom)+","+(ys+17/defaultZoom))
		.attr("transform", "translate(" + translate + ")scale(" + scale + ")")
    	.attr("class","geocurrent geocenter")
		.attr("fill", "#74c476" )
				.attr("stroke", "black")
				.attr("stroke-width",1/defaultZoom)
				.style("opacity",0.8)
				.on("mouseover", function() {
                    tiptext = [{"name":"Geocenter","rank":"Weighted"},[year],["Year"]];
                    tipshow();
                    return;
                })
				.on("mouseout", tiphide);
	
	var lat = 0;
	var lon = 0;
	for (var i in u[year]) {
		lat = lat + v[u[year][i].name].coord[1]*1
		lon = lon + v[u[year][i].name].coord[0]*1
	}

	lat = lat / u[year].length;
	lon = lon / u[year].length;
	var xs = projection([lat, lon])[0];
	var ys = projection([lat, lon])[1];
	svg.append("polygon")
		.attr("points", xs+","+(ys+5)+" "+(xs+5/defaultZoom)+","+(ys+17/defaultZoom)+" "+(xs-5/defaultZoom)+","+(ys+17/defaultZoom))
		.attr("transform", "translate(" + translate + ")scale(" + scale + ")")
    	.attr("class","geocurrent geocenter")
		.attr("fill", "red" )
				.attr("stroke", "black")
				.attr("stroke-width",1/defaultZoom)
				.style("opacity",0.8)
				.on("mouseover", function() {
                    tiptext = [{"name":"Geocenter","rank":"Unweighted"},[year],["Year"]];
                    tipshow();
                    return;
                })
				.on("mouseout", tiphide);
	//console.log(lat,lon);
};
				
};

function geos(){
for (var year=2003; year<2017+1; year++){
	var lat = 0;
	var lon = 0;
	var su =0;
	for (var i in u[year]) {
		lat = lat + v[u[year][i].name].coord[1]*1.0/parseInt(Math.sqrt(u[year][i].rank.slice(0,3)))
		lon = lon + v[u[year][i].name].coord[0]*1.0/parseInt(Math.sqrt(u[year][i].rank.slice(0,3)))
		su = su + 1.0/parseInt(Math.sqrt(u[year][i].rank.slice(0,3)));
	}

	lat = lat / su;
	lon = lon / su;
	var xs = projection([lat, lon])[0];
	var ys = projection([lat, lon])[1];
	svg.append("polygon")
		.datum(year)
		.attr("points", xs+","+ys+" "+(xs+10/scale)+","+(ys+20/scale)+" "+(xs-10/scale)+","+(ys+20/scale))
		
		.attr("class","geocenter")
		.attr("fill", colors3[parseInt((year-2003)/2)] )
				.attr("stroke", "black")
				.attr("stroke-width",1/scale)
				.style("opacity",0.8)
				.on("mouseover", function(d) {
                    tiptext = [{"name":"Geocenter","rank":"Weighted"},[d],["Year"]];
                    tipshow();
                    return;
                })
				.on("mouseout", tiphide);
	
	var lat = 0;
	var lon = 0;
	for (var i in u[year]) {
		lat = lat + v[u[year][i].name].coord[1]*1.0
		lon = lon + v[u[year][i].name].coord[0]*1.0
	}

	lat = lat / u[year].length;
	lon = lon / u[year].length;
	var xs = projection([lat, lon])[0];
	var ys = projection([lat, lon])[1];
	svg.append("polygon")
		.datum(year)
		.attr("points", xs+","+ys+" "+(xs+10/scale)+","+(ys+20/scale)+" "+(xs-10/scale)+","+(ys+20/scale))
		
		.attr("class","geocenter")
		.attr("fill", colors2[parseInt((year-2003)/2)] )
				.attr("stroke", "black")
				.attr("stroke-width",1/scale)
				.style("opacity",0.8)
				
				.on("mouseover", function(d) {
                    tiptext = [{"name":"Geocenter","rank":"Unweighted"},[d],["Year"]];
                    tipshow();
                    return;
                })
				.on("mouseout", tiphide);
	
	
	if (year<2011){
	xs=25;
	ys=378-(2013-year)*15;
	svg.append("polygon")
		.attr("points", xs+","+ys+" "+(xs+5)+","+(ys+10)+" "+(xs-5)+","+(ys+10))
		
		.attr("fill", colors2[parseInt(year-2003)] )
				.attr("stroke", "black")
				.attr("stroke-width",1)
				.style("opacity",0.8)
	xs=13;			
	svg.append("polygon")
		.attr("points", xs+","+ys+" "+(xs+5)+","+(ys+10)+" "+(xs-5)+","+(ys+10))
		
		.attr("fill", colors3[parseInt(year-2003)] )
				.attr("stroke", "black")
				.attr("stroke-width",1)
				.style("opacity",0.8)
	svg.append("text")
		.attr("x",xs+21)
		.text(2003+parseInt(year-2003)*2)
		.attr("y",ys+9)
		.style("fill", colors2[parseInt(year-2003)] )
		.style("font-size","10px");
	
	svg.append("text")
		.attr("x",44)
		.text("Unweighted")
		.attr("y",237)
		.attr("transform","rotate(-90 29,237)")
		.style("fill", colors2[1] )
		.style("font-size","8px");
	svg.append("text")
		.attr("x",32)
		.text("Weighted")
		.attr("y",236)
		.attr("transform","rotate(-90 17,236)")
		.style("fill", colors3[1] )
		.style("font-size","8px");
}}
};

geos();
update(yr);
reset();


function clicked(d) {
  if (active.node() === this) return reset();
  active.classed("active", false);
  active = d3.select(this).classed("active", true);

  var bounds = path.bounds(d),
      dx = bounds[1][0] - bounds[0][0],
      dy = bounds[1][1] - bounds[0][1],
      x = (bounds[0][0] + bounds[1][0]) / 2,
      y = (bounds[0][1] + bounds[1][1]) / 2;
      
  scale = .9 / Math.max(dx / width, dy / height);
  
  translate = [width / 2 - scale * x, height / 2 - scale * y];

  svg.transition()
      .duration(750)
      .call(zoom.translate(translate).scale(scale).event);
}

function reset() {
  active.classed("active", false);
  active = d3.select(null);
  scale=defaultZoom;
  translate=[defaultTranslateX, defaultTranslateY];
  svg.transition()
      .duration(750)
      .call(zoom.translate([defaultTranslateX, defaultTranslateY]).scale(defaultZoom).event);

}

function zoomed() {
  scale=d3.event.scale;
  translate=d3.event.translate;
  g.style("stroke-width", 1.5 / d3.event.scale + "px");
  g.attr("transform", "translate(" + d3.event.translate + ")scale(" + d3.event.scale + ")");
  d3.selectAll("circle").attr("transform", "translate(" + d3.event.translate + ")scale(" + d3.event.scale + ")")
  .attr("r",function(d){
	return (Math.sqrt(2000/Math.max(1,(d.rank.substr(0,3)-0)))+2)/d3.event.scale;
  })
  .attr("stroke-width",1/d3.event.scale);
  d3.selectAll(".geocenter").attr("transform", "translate(" + d3.event.translate + ")scale(" + d3.event.scale + ")");
}

// If the drag behavior prevents the default click,
// also stop propagation so we don’t click-to-zoom.
function stopped() {
  if (d3.event.defaultPrevented) d3.event.stopPropagation();
}


var densityslider = new Dragdealer("pslider", {
            x: 1,
            steps: 2017 - 2002,
            snap: true,
            animationCallback: function(a) {
                yr = Math.round(2003 + (2017 - 2003) * a);
                update(yr);
            }
        });

        scroll = function(a) {
            if (a < 0) yr = Math.max(2003, yr - 1)
            else yr = Math.min(yr + 1, 2017)
            densityslider.setValue((yr - 2003) / (2017 - 2003));
        }

        document.addEventListener("keydown", function(event) {
            if ((event.keyCode >= 33 && event.keyCode <= 34) || (event.keyCode >= 37 && event.keyCode <= 40)) {
                switch (event.keyCode) {
                    case 33: // pg up
                    case 37: // left
                    case 38: // up
                        scroll(-1);
                        break;
                    case 34: // pg down
                    case 39: // right
                    case 40: // down 
                        scroll(1);
                        break;
                }

                event.preventDefault();
            }
        }, false);


});
})		
		
var rescale = function() {
//scale content
var scal = Math.min((document.getElementById("container").parentElement.offsetWidth) / document.getElementById("container").offsetWidth, (document.getElementById("container").parentElement.offsetHeight) / document.getElementById("container").offsetHeight)
document.getElementById("container").style.WebkitTransform = "scale(" + scal + ")";
document.getElementById("container").style.OTransform = "scale(" + scal + ")";
document.getElementById("container").style.MozTransform = "scale(" + scal + ")";
document.getElementById("container").style.msTransform = "scale(" + scal + ")";
document.getElementById("container").style.Transform = "scale(" + scal + ")";

document.getElementById("container").style.WebkitTransformOrigin = "0 0";
document.getElementById("container").style.OTransformOrigin = "0 0";
document.getElementById("container").style.MozTransformOrigin = "0 0";
document.getElementById("container").style.msTransformOrigin = "0 0";
document.getElementById("container").style.TransformOrigin = "0 0";

};

window.onresize = function() {
rescale();
}

//init content
rescale();
d3.select("#container").transition().delay(1000).duration(500).style("opacity", "1");
d3.select("#social").transition().delay(3000).duration(500).style("opacity", "1");
</script>
