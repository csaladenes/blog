
<!-- saved from url=(0056)http://flowingdata.com/projects/2015/timeuse-simulation/ -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"></head><body><div class="line-gutter-backdrop"></div><table><tbody><tr><td class="line-number" value="1"></td><td class="line-content"><span class="html-doctype">&lt;!DOCTYPE html&gt;</span></td></tr><tr><td class="line-number" value="2"></td><td class="line-content"><span class="html-tag">&lt;head&gt;</span></td></tr><tr><td class="line-number" value="3"></td><td class="line-content"><span class="html-tag">&lt;title&gt;</span>Time Use Simulation<span class="html-tag">&lt;/title&gt;</span></td></tr><tr><td class="line-number" value="4"></td><td class="line-content"><span class="html-tag">&lt;link <span class="html-attribute-name">rel</span>="<span class="html-attribute-value">stylesheet</span>" <span class="html-attribute-name">href</span>="<a class="html-attribute-value html-resource-link" target="_blank" href="http://flowingdata.com/projects/2015/timeuse-simulation/style/style.css">style/style.css</a>" <span class="html-attribute-name">type</span>="<span class="html-attribute-value">text/css</span>" <span class="html-attribute-name">media</span>="<span class="html-attribute-value">screen</span>"/&gt;</span></td></tr><tr><td class="line-number" value="5"></td><td class="line-content"><span class="html-tag">&lt;link <span class="html-attribute-name">rel</span>="<span class="html-attribute-value">stylesheet</span>" <span class="html-attribute-name">type</span>="<span class="html-attribute-value">text/css</span>" <span class="html-attribute-name">href</span>="<a class="html-attribute-value html-resource-link" target="_blank" href="http://cloud.typography.com/7626174/696048/css/fonts.css">//cloud.typography.com/7626174/696048/css/fonts.css</a>"/&gt;</span></td></tr><tr><td class="line-number" value="6"></td><td class="line-content"><span class="html-tag">&lt;link <span class="html-attribute-name">href</span>='<a class="html-attribute-value html-resource-link" target="_blank" href="https://fonts.googleapis.com/css?family=Inconsolata">https://fonts.googleapis.com/css?family=Inconsolata</a>' <span class="html-attribute-name">rel</span>='<span class="html-attribute-value">stylesheet</span>' <span class="html-attribute-name">type</span>='<span class="html-attribute-value">text/css</span>'&gt;</span></td></tr><tr><td class="line-number" value="7"></td><td class="line-content"><span class="html-tag">&lt;/head&gt;</span></td></tr><tr><td class="line-number" value="8"></td><td class="line-content"><span class="html-tag">&lt;meta <span class="html-attribute-name">charset</span>="<span class="html-attribute-value">utf-8</span>"&gt;</span></td></tr><tr><td class="line-number" value="9"></td><td class="line-content"><span class="html-tag">&lt;style&gt;</span>.node{stroke-width:1.5px;}<span class="html-tag">&lt;/style&gt;</span></td></tr><tr><td class="line-number" value="10"></td><td class="line-content"><span class="html-tag">&lt;body&gt;</span></td></tr><tr><td class="line-number" value="11"></td><td class="line-content"><span class="html-tag">&lt;div <span class="html-attribute-name">id</span>="<span class="html-attribute-value">main-wrapper</span>"&gt;</span></td></tr><tr><td class="line-number" value="12"></td><td class="line-content"><span class="html-tag">&lt;div <span class="html-attribute-name">id</span>="<span class="html-attribute-value">sidebar</span>"&gt;</span></td></tr><tr><td class="line-number" value="13"></td><td class="line-content"><span class="html-tag">&lt;div <span class="html-attribute-name">id</span>="<span class="html-attribute-value">current_time</span>"&gt;</span>4:00am<span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="14"></td><td class="line-content"><span class="html-tag">&lt;div <span class="html-attribute-name">id</span>="<span class="html-attribute-value">speed</span>"&gt;</span></td></tr><tr><td class="line-number" value="15"></td><td class="line-content"><span class="html-tag">&lt;div <span class="html-attribute-name">class</span>="<span class="html-attribute-value">togglebutton slow current</span>" <span class="html-attribute-name">data-val</span>="<span class="html-attribute-value">slow</span>"&gt;</span>Slow<span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="16"></td><td class="line-content"><span class="html-tag">&lt;div <span class="html-attribute-name">class</span>="<span class="html-attribute-value">togglebutton medium</span>" <span class="html-attribute-name">data-val</span>="<span class="html-attribute-value">medium</span>"&gt;</span>Medium<span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="17"></td><td class="line-content"><span class="html-tag">&lt;div <span class="html-attribute-name">class</span>="<span class="html-attribute-value">togglebutton fast</span>" <span class="html-attribute-name">data-val</span>="<span class="html-attribute-value">fast</span>"&gt;</span>Fast<span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="18"></td><td class="line-content"><span class="html-tag">&lt;div <span class="html-attribute-name">class</span>="<span class="html-attribute-value">clr</span>"&gt;</span><span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="19"></td><td class="line-content"><span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="20"></td><td class="line-content"><span class="html-tag">&lt;div <span class="html-attribute-name">id</span>="<span class="html-attribute-value">note</span>"&gt;</span><span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="21"></td><td class="line-content"><span class="html-tag">&lt;div <span class="html-attribute-name">id</span>="<span class="html-attribute-value">cite</span>"&gt;</span></td></tr><tr><td class="line-number" value="22"></td><td class="line-content">This is a simulation of 1,000 people's average day. It's based on 2014 data from the <span class="html-tag">&lt;a <span class="html-attribute-name">href</span>="<a class="html-attribute-value html-external-link" target="_blank" href="http://www.bls.gov/tus/">http://www.bls.gov/tus/</a>"&gt;</span>American Time Use Survey<span class="html-tag">&lt;/a&gt;</span>, made way more accessible by the <span class="html-tag">&lt;a <span class="html-attribute-name">href</span>="<a class="html-attribute-value html-external-link" target="_blank" href="https://www.atusdata.org/">https://www.atusdata.org/</a>"&gt;</span>ATUS Extract Builder<span class="html-tag">&lt;/a&gt;</span>.</td></tr><tr><td class="line-number" value="23"></td><td class="line-content"><span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="24"></td><td class="line-content"><span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="25"></td><td class="line-content"><span class="html-tag">&lt;div <span class="html-attribute-name">id</span>="<span class="html-attribute-value">chart</span>"&gt;</span><span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="26"></td><td class="line-content"><span class="html-tag">&lt;div <span class="html-attribute-name">class</span>="<span class="html-attribute-value">clr</span>"&gt;</span><span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="27"></td><td class="line-content"><span class="html-tag">&lt;/div&gt;</span></td></tr><tr><td class="line-number" value="28"></td><td class="line-content"><span class="html-tag">&lt;script <span class="html-attribute-name">src</span>="<a class="html-attribute-value html-resource-link" target="_blank" href="http://flowingdata.com/projects/2015/timeuse-simulation/js/d3-3-5-5.min.js">js/d3-3-5-5.min.js</a>"&gt;</span><span class="html-tag">&lt;/script&gt;</span></td></tr><tr><td class="line-number" value="29"></td><td class="line-content"><span class="html-tag">&lt;script&gt;</span></td></tr><tr><td class="line-number" value="30"></td><td class="line-content">var USER_SPEED = "slow";</td></tr><tr><td class="line-number" value="31"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="32"></td><td class="line-content">var width = 780,</td></tr><tr><td class="line-number" value="33"></td><td class="line-content">    height = 800,</td></tr><tr><td class="line-number" value="34"></td><td class="line-content">	padding = 1,</td></tr><tr><td class="line-number" value="35"></td><td class="line-content">	maxRadius = 3;</td></tr><tr><td class="line-number" value="36"></td><td class="line-content">	// color = d3.scale.category10();</td></tr><tr><td class="line-number" value="37"></td><td class="line-content">	</td></tr><tr><td class="line-number" value="38"></td><td class="line-content">var sched_objs = [],</td></tr><tr><td class="line-number" value="39"></td><td class="line-content">	curr_minute = 0;</td></tr><tr><td class="line-number" value="40"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="41"></td><td class="line-content">var act_codes = [</td></tr><tr><td class="line-number" value="42"></td><td class="line-content">	{"index": "0", "short": "Sleeping", "desc": "Sleeping"},</td></tr><tr><td class="line-number" value="43"></td><td class="line-content">	{"index": "1", "short": "Personal Care", "desc": "Personal Care"},</td></tr><tr><td class="line-number" value="44"></td><td class="line-content">	{"index": "2", "short": "Eating &amp; Drinking", "desc": "Eating and Drinking"},</td></tr><tr><td class="line-number" value="45"></td><td class="line-content">	{"index": "3", "short": "Education", "desc": "Education"},</td></tr><tr><td class="line-number" value="46"></td><td class="line-content">	{"index": "4", "short": "Work", "desc": "Work and Work-Related Activities"},</td></tr><tr><td class="line-number" value="47"></td><td class="line-content">	{"index": "5", "short": "Housework", "desc": "Household Activities"},</td></tr><tr><td class="line-number" value="48"></td><td class="line-content">	{"index": "6", "short": "Household Care", "desc": "Caring for and Helping Household Members"},</td></tr><tr><td class="line-number" value="49"></td><td class="line-content">	{"index": "7", "short": "Non-Household Care", "desc": "Caring for and Helping Non-Household Members"},</td></tr><tr><td class="line-number" value="50"></td><td class="line-content">	{"index": "8", "short": "Shopping", "desc": "Consumer Purchases"},</td></tr><tr><td class="line-number" value="51"></td><td class="line-content">	{"index": "9", "short": "Pro. Care Services", "desc": "Professional and Personal Care Services"},</td></tr><tr><td class="line-number" value="52"></td><td class="line-content">	{"index": "10", "short": "Leisure", "desc": "Socializing, Relaxing, and Leisure"},</td></tr><tr><td class="line-number" value="53"></td><td class="line-content">	{"index": "11", "short": "Sports", "desc": "Sports, Exercise, and Recreation"},</td></tr><tr><td class="line-number" value="54"></td><td class="line-content">	{"index": "12", "short": "Religion", "desc": "Religious and Spiritual Activities"},</td></tr><tr><td class="line-number" value="55"></td><td class="line-content">	{"index": "13", "short": "Volunteering", "desc": "Volunteer Activities"},</td></tr><tr><td class="line-number" value="56"></td><td class="line-content">	{"index": "14", "short": "Phone Calls", "desc": "Telephone Calls"},</td></tr><tr><td class="line-number" value="57"></td><td class="line-content">	{"index": "15", "short": "Misc.", "desc": "Other"},</td></tr><tr><td class="line-number" value="58"></td><td class="line-content">	{"index": "16", "short": "Traveling", "desc": "Traveling"},</td></tr><tr><td class="line-number" value="59"></td><td class="line-content">];</td></tr><tr><td class="line-number" value="60"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="61"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="62"></td><td class="line-content">var speeds = { "slow": 1000, "medium": 200, "fast": 50 };</td></tr><tr><td class="line-number" value="63"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="64"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="65"></td><td class="line-content">var time_notes = [</td></tr><tr><td class="line-number" value="66"></td><td class="line-content">	{ "start_minute": 1, "stop_minute": 40, "note": "The simulation kicks in, based on data from the American Time Use Survey." },</td></tr><tr><td class="line-number" value="67"></td><td class="line-content">	{ "start_minute": 70, "stop_minute": 120, "note": "Most people are still sleeping this early in the morning, but some are already at work or preparing for the day." },</td></tr><tr><td class="line-number" value="68"></td><td class="line-content">	{ "start_minute": 180, "stop_minute": 300, "note": "It's wake up time for most. Time to start the day with morning rituals, breakfast and a wonderful commute." },</td></tr><tr><td class="line-number" value="69"></td><td class="line-content">	{ "start_minute": 360, "stop_minute": 440, "note": "The day is in full swing with work or housework. Stores and services are open so people can run errands, and they take various forms of transportation to get there." },</td></tr><tr><td class="line-number" value="70"></td><td class="line-content">	{ "start_minute": 480, "stop_minute": 540, "note": "Lunch hour. Many go eat, but there's still activity throughout. You see a small shift at the end of the hour." },</td></tr><tr><td class="line-number" value="71"></td><td class="line-content">	{ "start_minute": 660, "stop_minute": 720, "note": "Coffee break? Again, at the top of the hour, you see a shift in activity." },</td></tr><tr><td class="line-number" value="72"></td><td class="line-content">	{ "start_minute": 780, "stop_minute": 830, "note": "With the work day done, it's time to commute home and fix dinner or go out for a while." },</td></tr><tr><td class="line-number" value="73"></td><td class="line-content">	{ "start_minute": 870, "stop_minute": 890, "note": "Dinner time!" },</td></tr><tr><td class="line-number" value="74"></td><td class="line-content">	{ "start_minute": 930, "stop_minute": 1010, "note": "Dinner's done. Time for relaxation, TV, games, hobbies and socializing." },</td></tr><tr><td class="line-number" value="75"></td><td class="line-content">	{ "start_minute": 1080, "stop_minute": 1140, "note": "Winding down for the day. From leisure time, people shift to personal care and sleep." },</td></tr><tr><td class="line-number" value="76"></td><td class="line-content">	{ "start_minute": 1210, "stop_minute": 1300, "note": "Goodnight. More than 80% of people are asleep and it peaks at 96% around 3:00am." },</td></tr><tr><td class="line-number" value="77"></td><td class="line-content">];</td></tr><tr><td class="line-number" value="78"></td><td class="line-content">var notes_index = 0;</td></tr><tr><td class="line-number" value="79"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="80"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="81"></td><td class="line-content">// Activity to put in center of circle arrangement</td></tr><tr><td class="line-number" value="82"></td><td class="line-content">var center_act = "Traveling",</td></tr><tr><td class="line-number" value="83"></td><td class="line-content">	center_pt = { "x": 380, "y": 365 };</td></tr><tr><td class="line-number" value="84"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="85"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="86"></td><td class="line-content">// Coordinates for activities</td></tr><tr><td class="line-number" value="87"></td><td class="line-content">var foci = {};</td></tr><tr><td class="line-number" value="88"></td><td class="line-content">act_codes.forEach(function(code, i) {</td></tr><tr><td class="line-number" value="89"></td><td class="line-content">	if (code.desc == center_act) {</td></tr><tr><td class="line-number" value="90"></td><td class="line-content">		foci[code.index] = center_pt;</td></tr><tr><td class="line-number" value="91"></td><td class="line-content">	} else {</td></tr><tr><td class="line-number" value="92"></td><td class="line-content">		var theta = 2 * Math.PI / (act_codes.length-1);</td></tr><tr><td class="line-number" value="93"></td><td class="line-content">		foci[code.index] = {x: 250 * Math.cos(i * theta)+380, y: 250 * Math.sin(i * theta)+365 };</td></tr><tr><td class="line-number" value="94"></td><td class="line-content">	}</td></tr><tr><td class="line-number" value="95"></td><td class="line-content">});</td></tr><tr><td class="line-number" value="96"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="97"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="98"></td><td class="line-content">// Start the SVG</td></tr><tr><td class="line-number" value="99"></td><td class="line-content">var svg = d3.select("#chart").append("svg")</td></tr><tr><td class="line-number" value="100"></td><td class="line-content">    .attr("width", width)</td></tr><tr><td class="line-number" value="101"></td><td class="line-content">    .attr("height", height);</td></tr><tr><td class="line-number" value="102"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="103"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="104"></td><td class="line-content">// Load data and let's do it.</td></tr><tr><td class="line-number" value="105"></td><td class="line-content">d3.tsv("data/days-simulated-v2.tsv", function(error, data) {	</td></tr><tr><td class="line-number" value="106"></td><td class="line-content">	</td></tr><tr><td class="line-number" value="107"></td><td class="line-content">	data.forEach(function(d) {</td></tr><tr><td class="line-number" value="108"></td><td class="line-content">		var day_array = d.day.split(",");</td></tr><tr><td class="line-number" value="109"></td><td class="line-content">		var activities = [];</td></tr><tr><td class="line-number" value="110"></td><td class="line-content">		for (var i=0; i &lt; day_array.length; i++) {</td></tr><tr><td class="line-number" value="111"></td><td class="line-content">			// Duration</td></tr><tr><td class="line-number" value="112"></td><td class="line-content">			if (i % 2 == 1) {</td></tr><tr><td class="line-number" value="113"></td><td class="line-content">				activities.push({'act': day_array[i-1], 'duration': +day_array[i]});</td></tr><tr><td class="line-number" value="114"></td><td class="line-content">			}</td></tr><tr><td class="line-number" value="115"></td><td class="line-content">		}</td></tr><tr><td class="line-number" value="116"></td><td class="line-content">		sched_objs.push(activities);</td></tr><tr><td class="line-number" value="117"></td><td class="line-content">	});</td></tr><tr><td class="line-number" value="118"></td><td class="line-content">	</td></tr><tr><td class="line-number" value="119"></td><td class="line-content">	// Used for percentages by minute</td></tr><tr><td class="line-number" value="120"></td><td class="line-content">	var act_counts = { "0": 0, "1": 0, "2": 0, "3": 0, "4": 0, "5": 0, "6": 0, "7": 0, "8": 0, "9": 0, "10": 0, "11": 0, "12": 0, "13": 0, "14": 0, "15": 0, "16": 0 };</td></tr><tr><td class="line-number" value="121"></td><td class="line-content">	</td></tr><tr><td class="line-number" value="122"></td><td class="line-content">	// A node for each person's schedule</td></tr><tr><td class="line-number" value="123"></td><td class="line-content">	var nodes = sched_objs.map(function(o,i) {</td></tr><tr><td class="line-number" value="124"></td><td class="line-content">		var act = o[0].act;</td></tr><tr><td class="line-number" value="125"></td><td class="line-content">		act_counts[act] += 1;</td></tr><tr><td class="line-number" value="126"></td><td class="line-content">		var init_x = foci[act].x + Math.random();</td></tr><tr><td class="line-number" value="127"></td><td class="line-content">		var init_y = foci[act].y + Math.random();</td></tr><tr><td class="line-number" value="128"></td><td class="line-content">		return {</td></tr><tr><td class="line-number" value="129"></td><td class="line-content">			act: act,</td></tr><tr><td class="line-number" value="130"></td><td class="line-content">			radius: 3,</td></tr><tr><td class="line-number" value="131"></td><td class="line-content">			x: init_x,</td></tr><tr><td class="line-number" value="132"></td><td class="line-content">			y: init_y,</td></tr><tr><td class="line-number" value="133"></td><td class="line-content">			color: color(act),</td></tr><tr><td class="line-number" value="134"></td><td class="line-content">			moves: 0,</td></tr><tr><td class="line-number" value="135"></td><td class="line-content">			next_move_time: o[0].duration,</td></tr><tr><td class="line-number" value="136"></td><td class="line-content">			sched: o,</td></tr><tr><td class="line-number" value="137"></td><td class="line-content">		}</td></tr><tr><td class="line-number" value="138"></td><td class="line-content">	});</td></tr><tr><td class="line-number" value="139"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="140"></td><td class="line-content">	var force = d3.layout.force()</td></tr><tr><td class="line-number" value="141"></td><td class="line-content">		.nodes(nodes)</td></tr><tr><td class="line-number" value="142"></td><td class="line-content">		.size([width, height])</td></tr><tr><td class="line-number" value="143"></td><td class="line-content">		// .links([])</td></tr><tr><td class="line-number" value="144"></td><td class="line-content">		.gravity(0)</td></tr><tr><td class="line-number" value="145"></td><td class="line-content">		.charge(0)</td></tr><tr><td class="line-number" value="146"></td><td class="line-content">		.friction(.9)</td></tr><tr><td class="line-number" value="147"></td><td class="line-content">		.on("tick", tick)</td></tr><tr><td class="line-number" value="148"></td><td class="line-content">		.start();</td></tr><tr><td class="line-number" value="149"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="150"></td><td class="line-content">	var circle = svg.selectAll("circle")</td></tr><tr><td class="line-number" value="151"></td><td class="line-content">		.data(nodes)</td></tr><tr><td class="line-number" value="152"></td><td class="line-content">	  .enter().append("circle")</td></tr><tr><td class="line-number" value="153"></td><td class="line-content">		.attr("r", function(d) { return d.radius; })</td></tr><tr><td class="line-number" value="154"></td><td class="line-content">		.style("fill", function(d) { return d.color; });</td></tr><tr><td class="line-number" value="155"></td><td class="line-content">		// .call(force.drag);</td></tr><tr><td class="line-number" value="156"></td><td class="line-content">	</td></tr><tr><td class="line-number" value="157"></td><td class="line-content">	// Activity labels</td></tr><tr><td class="line-number" value="158"></td><td class="line-content">	var label = svg.selectAll("text")</td></tr><tr><td class="line-number" value="159"></td><td class="line-content">		.data(act_codes)</td></tr><tr><td class="line-number" value="160"></td><td class="line-content">	  .enter().append("text")</td></tr><tr><td class="line-number" value="161"></td><td class="line-content">		.attr("class", "actlabel")</td></tr><tr><td class="line-number" value="162"></td><td class="line-content">		.attr("x", function(d, i) {</td></tr><tr><td class="line-number" value="163"></td><td class="line-content">			if (d.desc == center_act) {</td></tr><tr><td class="line-number" value="164"></td><td class="line-content">				return center_pt.x;</td></tr><tr><td class="line-number" value="165"></td><td class="line-content">			} else {</td></tr><tr><td class="line-number" value="166"></td><td class="line-content">				var theta = 2 * Math.PI / (act_codes.length-1);</td></tr><tr><td class="line-number" value="167"></td><td class="line-content">				return 340 * Math.cos(i * theta)+380;</td></tr><tr><td class="line-number" value="168"></td><td class="line-content">			}</td></tr><tr><td class="line-number" value="169"></td><td class="line-content">			</td></tr><tr><td class="line-number" value="170"></td><td class="line-content">		})</td></tr><tr><td class="line-number" value="171"></td><td class="line-content">		.attr("y", function(d, i) {</td></tr><tr><td class="line-number" value="172"></td><td class="line-content">			if (d.desc == center_act) {</td></tr><tr><td class="line-number" value="173"></td><td class="line-content">				return center_pt.y;</td></tr><tr><td class="line-number" value="174"></td><td class="line-content">			} else {</td></tr><tr><td class="line-number" value="175"></td><td class="line-content">				var theta = 2 * Math.PI / (act_codes.length-1);</td></tr><tr><td class="line-number" value="176"></td><td class="line-content">				return 340 * Math.sin(i * theta)+365;</td></tr><tr><td class="line-number" value="177"></td><td class="line-content">			}</td></tr><tr><td class="line-number" value="178"></td><td class="line-content">			</td></tr><tr><td class="line-number" value="179"></td><td class="line-content">		});</td></tr><tr><td class="line-number" value="180"></td><td class="line-content">		</td></tr><tr><td class="line-number" value="181"></td><td class="line-content">	label.append("tspan")</td></tr><tr><td class="line-number" value="182"></td><td class="line-content">		.attr("x", function() { return d3.select(this.parentNode).attr("x"); })</td></tr><tr><td class="line-number" value="183"></td><td class="line-content">		// .attr("dy", "1.3em")</td></tr><tr><td class="line-number" value="184"></td><td class="line-content">		.attr("text-anchor", "middle")</td></tr><tr><td class="line-number" value="185"></td><td class="line-content">		.text(function(d) {</td></tr><tr><td class="line-number" value="186"></td><td class="line-content">			return d.short;</td></tr><tr><td class="line-number" value="187"></td><td class="line-content">		});</td></tr><tr><td class="line-number" value="188"></td><td class="line-content">	label.append("tspan")</td></tr><tr><td class="line-number" value="189"></td><td class="line-content">		.attr("dy", "1.3em")</td></tr><tr><td class="line-number" value="190"></td><td class="line-content">		.attr("x", function() { return d3.select(this.parentNode).attr("x"); })</td></tr><tr><td class="line-number" value="191"></td><td class="line-content">		.attr("text-anchor", "middle")</td></tr><tr><td class="line-number" value="192"></td><td class="line-content">		.attr("class", "actpct")</td></tr><tr><td class="line-number" value="193"></td><td class="line-content">		.text(function(d) {</td></tr><tr><td class="line-number" value="194"></td><td class="line-content">			return act_counts[d.index] + "%";</td></tr><tr><td class="line-number" value="195"></td><td class="line-content">		});</td></tr><tr><td class="line-number" value="196"></td><td class="line-content">		</td></tr><tr><td class="line-number" value="197"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="198"></td><td class="line-content">	// Update nodes based on activity and duration</td></tr><tr><td class="line-number" value="199"></td><td class="line-content">	function timer() {</td></tr><tr><td class="line-number" value="200"></td><td class="line-content">		d3.range(nodes.length).map(function(i) {</td></tr><tr><td class="line-number" value="201"></td><td class="line-content">			var curr_node = nodes[i],</td></tr><tr><td class="line-number" value="202"></td><td class="line-content">				curr_moves = curr_node.moves; </td></tr><tr><td class="line-number" value="203"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="204"></td><td class="line-content">			// Time to go to next activity</td></tr><tr><td class="line-number" value="205"></td><td class="line-content">			if (curr_node.next_move_time == curr_minute) {</td></tr><tr><td class="line-number" value="206"></td><td class="line-content">				if (curr_node.moves == curr_node.sched.length-1) {</td></tr><tr><td class="line-number" value="207"></td><td class="line-content">					curr_moves = 0;</td></tr><tr><td class="line-number" value="208"></td><td class="line-content">				} else {</td></tr><tr><td class="line-number" value="209"></td><td class="line-content">					curr_moves += 1;</td></tr><tr><td class="line-number" value="210"></td><td class="line-content">				}</td></tr><tr><td class="line-number" value="211"></td><td class="line-content">			</td></tr><tr><td class="line-number" value="212"></td><td class="line-content">				// Subtract from current activity count</td></tr><tr><td class="line-number" value="213"></td><td class="line-content">				act_counts[curr_node.act] -= 1;</td></tr><tr><td class="line-number" value="214"></td><td class="line-content">			</td></tr><tr><td class="line-number" value="215"></td><td class="line-content">				// Move on to next activity</td></tr><tr><td class="line-number" value="216"></td><td class="line-content">				curr_node.act = curr_node.sched[ curr_moves ].act;</td></tr><tr><td class="line-number" value="217"></td><td class="line-content">			</td></tr><tr><td class="line-number" value="218"></td><td class="line-content">				// Add to new activity count</td></tr><tr><td class="line-number" value="219"></td><td class="line-content">				act_counts[curr_node.act] += 1;</td></tr><tr><td class="line-number" value="220"></td><td class="line-content">			</td></tr><tr><td class="line-number" value="221"></td><td class="line-content">				curr_node.moves = curr_moves;</td></tr><tr><td class="line-number" value="222"></td><td class="line-content">				curr_node.cx = foci[curr_node.act].x;</td></tr><tr><td class="line-number" value="223"></td><td class="line-content">				curr_node.cy = foci[curr_node.act].y;</td></tr><tr><td class="line-number" value="224"></td><td class="line-content">			</td></tr><tr><td class="line-number" value="225"></td><td class="line-content">				nodes[i].next_move_time += nodes[i].sched[ curr_node.moves ].duration;</td></tr><tr><td class="line-number" value="226"></td><td class="line-content">			}</td></tr><tr><td class="line-number" value="227"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="228"></td><td class="line-content">		});</td></tr><tr><td class="line-number" value="229"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="230"></td><td class="line-content">		force.resume();</td></tr><tr><td class="line-number" value="231"></td><td class="line-content">		curr_minute += 1;</td></tr><tr><td class="line-number" value="232"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="233"></td><td class="line-content">		// Update percentages</td></tr><tr><td class="line-number" value="234"></td><td class="line-content">		label.selectAll("tspan.actpct")</td></tr><tr><td class="line-number" value="235"></td><td class="line-content">			.text(function(d) {</td></tr><tr><td class="line-number" value="236"></td><td class="line-content">				return readablePercent(act_counts[d.index]);</td></tr><tr><td class="line-number" value="237"></td><td class="line-content">			});</td></tr><tr><td class="line-number" value="238"></td><td class="line-content">	</td></tr><tr><td class="line-number" value="239"></td><td class="line-content">		// Update time</td></tr><tr><td class="line-number" value="240"></td><td class="line-content">		var true_minute = curr_minute % 1440;</td></tr><tr><td class="line-number" value="241"></td><td class="line-content">		d3.select("#current_time").text(minutesToTime(true_minute));</td></tr><tr><td class="line-number" value="242"></td><td class="line-content">		</td></tr><tr><td class="line-number" value="243"></td><td class="line-content">		// Update notes</td></tr><tr><td class="line-number" value="244"></td><td class="line-content">		// var true_minute = curr_minute % 1440;</td></tr><tr><td class="line-number" value="245"></td><td class="line-content">		if (true_minute == time_notes[notes_index].start_minute) {</td></tr><tr><td class="line-number" value="246"></td><td class="line-content">			d3.select("#note")</td></tr><tr><td class="line-number" value="247"></td><td class="line-content">				.style("top", "0px")</td></tr><tr><td class="line-number" value="248"></td><td class="line-content">			  .transition()</td></tr><tr><td class="line-number" value="249"></td><td class="line-content">				.duration(600)</td></tr><tr><td class="line-number" value="250"></td><td class="line-content">				.style("top", "20px")</td></tr><tr><td class="line-number" value="251"></td><td class="line-content">				.style("color", "#000000")</td></tr><tr><td class="line-number" value="252"></td><td class="line-content">				.text(time_notes[notes_index].note);</td></tr><tr><td class="line-number" value="253"></td><td class="line-content">		} </td></tr><tr><td class="line-number" value="254"></td><td class="line-content">		</td></tr><tr><td class="line-number" value="255"></td><td class="line-content">		// Make note disappear at the end.</td></tr><tr><td class="line-number" value="256"></td><td class="line-content">		else if (true_minute == time_notes[notes_index].stop_minute) {</td></tr><tr><td class="line-number" value="257"></td><td class="line-content">			</td></tr><tr><td class="line-number" value="258"></td><td class="line-content">			d3.select("#note").transition()</td></tr><tr><td class="line-number" value="259"></td><td class="line-content">				.duration(1000)</td></tr><tr><td class="line-number" value="260"></td><td class="line-content">				.style("top", "300px")</td></tr><tr><td class="line-number" value="261"></td><td class="line-content">				.style("color", "#ffffff");</td></tr><tr><td class="line-number" value="262"></td><td class="line-content">				</td></tr><tr><td class="line-number" value="263"></td><td class="line-content">			notes_index += 1;</td></tr><tr><td class="line-number" value="264"></td><td class="line-content">			if (notes_index == time_notes.length) {</td></tr><tr><td class="line-number" value="265"></td><td class="line-content">				notes_index = 0;</td></tr><tr><td class="line-number" value="266"></td><td class="line-content">			}</td></tr><tr><td class="line-number" value="267"></td><td class="line-content">		}</td></tr><tr><td class="line-number" value="268"></td><td class="line-content">		</td></tr><tr><td class="line-number" value="269"></td><td class="line-content">		</td></tr><tr><td class="line-number" value="270"></td><td class="line-content">		setTimeout(timer, speeds[USER_SPEED]);</td></tr><tr><td class="line-number" value="271"></td><td class="line-content">	}</td></tr><tr><td class="line-number" value="272"></td><td class="line-content">	setTimeout(timer, speeds[USER_SPEED]);</td></tr><tr><td class="line-number" value="273"></td><td class="line-content">	</td></tr><tr><td class="line-number" value="274"></td><td class="line-content">	</td></tr><tr><td class="line-number" value="275"></td><td class="line-content">	</td></tr><tr><td class="line-number" value="276"></td><td class="line-content">		</td></tr><tr><td class="line-number" value="277"></td><td class="line-content">	function tick(e) {</td></tr><tr><td class="line-number" value="278"></td><td class="line-content">	  var k = 0.04 * e.alpha;</td></tr><tr><td class="line-number" value="279"></td><td class="line-content">  </td></tr><tr><td class="line-number" value="280"></td><td class="line-content">	  // Push nodes toward their designated focus.</td></tr><tr><td class="line-number" value="281"></td><td class="line-content">	  nodes.forEach(function(o, i) {</td></tr><tr><td class="line-number" value="282"></td><td class="line-content">		var curr_act = o.act;</td></tr><tr><td class="line-number" value="283"></td><td class="line-content">		</td></tr><tr><td class="line-number" value="284"></td><td class="line-content">		// Make sleep more sluggish moving.</td></tr><tr><td class="line-number" value="285"></td><td class="line-content">		if (curr_act == "0") {</td></tr><tr><td class="line-number" value="286"></td><td class="line-content">			var damper = 0.6;</td></tr><tr><td class="line-number" value="287"></td><td class="line-content">		} else {</td></tr><tr><td class="line-number" value="288"></td><td class="line-content">			var damper = 1;</td></tr><tr><td class="line-number" value="289"></td><td class="line-content">		}</td></tr><tr><td class="line-number" value="290"></td><td class="line-content">		o.color = color(curr_act);</td></tr><tr><td class="line-number" value="291"></td><td class="line-content">	    o.y += (foci[curr_act].y - o.y) * k * damper;</td></tr><tr><td class="line-number" value="292"></td><td class="line-content">	    o.x += (foci[curr_act].x - o.x) * k * damper;</td></tr><tr><td class="line-number" value="293"></td><td class="line-content">	  });</td></tr><tr><td class="line-number" value="294"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="295"></td><td class="line-content">	  circle</td></tr><tr><td class="line-number" value="296"></td><td class="line-content">	  	  .each(collide(.5))</td></tr><tr><td class="line-number" value="297"></td><td class="line-content">	  	  .style("fill", function(d) { return d.color; })</td></tr><tr><td class="line-number" value="298"></td><td class="line-content">	      .attr("cx", function(d) { return d.x; })</td></tr><tr><td class="line-number" value="299"></td><td class="line-content">	      .attr("cy", function(d) { return d.y; });</td></tr><tr><td class="line-number" value="300"></td><td class="line-content">	}</td></tr><tr><td class="line-number" value="301"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="302"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="303"></td><td class="line-content">	// Resolve collisions between nodes.</td></tr><tr><td class="line-number" value="304"></td><td class="line-content">	function collide(alpha) {</td></tr><tr><td class="line-number" value="305"></td><td class="line-content">	  var quadtree = d3.geom.quadtree(nodes);</td></tr><tr><td class="line-number" value="306"></td><td class="line-content">	  return function(d) {</td></tr><tr><td class="line-number" value="307"></td><td class="line-content">	    var r = d.radius + maxRadius + padding,</td></tr><tr><td class="line-number" value="308"></td><td class="line-content">	        nx1 = d.x - r,</td></tr><tr><td class="line-number" value="309"></td><td class="line-content">	        nx2 = d.x + r,</td></tr><tr><td class="line-number" value="310"></td><td class="line-content">	        ny1 = d.y - r,</td></tr><tr><td class="line-number" value="311"></td><td class="line-content">	        ny2 = d.y + r;</td></tr><tr><td class="line-number" value="312"></td><td class="line-content">	    quadtree.visit(function(quad, x1, y1, x2, y2) {</td></tr><tr><td class="line-number" value="313"></td><td class="line-content">	      if (quad.point &amp;&amp; (quad.point !== d)) {</td></tr><tr><td class="line-number" value="314"></td><td class="line-content">	        var x = d.x - quad.point.x,</td></tr><tr><td class="line-number" value="315"></td><td class="line-content">	            y = d.y - quad.point.y,</td></tr><tr><td class="line-number" value="316"></td><td class="line-content">	            l = Math.sqrt(x * x + y * y),</td></tr><tr><td class="line-number" value="317"></td><td class="line-content">	            r = d.radius + quad.point.radius + (d.act !== quad.point.act) * padding;</td></tr><tr><td class="line-number" value="318"></td><td class="line-content">	        if (l &lt; r) {</td></tr><tr><td class="line-number" value="319"></td><td class="line-content">	          l = (l - r) / l * alpha;</td></tr><tr><td class="line-number" value="320"></td><td class="line-content">	          d.x -= x *= l;</td></tr><tr><td class="line-number" value="321"></td><td class="line-content">	          d.y -= y *= l;</td></tr><tr><td class="line-number" value="322"></td><td class="line-content">	          quad.point.x += x;</td></tr><tr><td class="line-number" value="323"></td><td class="line-content">	          quad.point.y += y;</td></tr><tr><td class="line-number" value="324"></td><td class="line-content">	        }</td></tr><tr><td class="line-number" value="325"></td><td class="line-content">	      }</td></tr><tr><td class="line-number" value="326"></td><td class="line-content">	      return x1 &gt; nx2 || x2 &lt; nx1 || y1 &gt; ny2 || y2 &lt; ny1;</td></tr><tr><td class="line-number" value="327"></td><td class="line-content">	    });</td></tr><tr><td class="line-number" value="328"></td><td class="line-content">	  };</td></tr><tr><td class="line-number" value="329"></td><td class="line-content">	}</td></tr><tr><td class="line-number" value="330"></td><td class="line-content">	</td></tr><tr><td class="line-number" value="331"></td><td class="line-content">	</td></tr><tr><td class="line-number" value="332"></td><td class="line-content">	</td></tr><tr><td class="line-number" value="333"></td><td class="line-content">	</td></tr><tr><td class="line-number" value="334"></td><td class="line-content">	// Speed toggle</td></tr><tr><td class="line-number" value="335"></td><td class="line-content">	d3.selectAll(".togglebutton")</td></tr><tr><td class="line-number" value="336"></td><td class="line-content">      .on("click", function() {</td></tr><tr><td class="line-number" value="337"></td><td class="line-content">        if (d3.select(this).attr("data-val") == "slow") {</td></tr><tr><td class="line-number" value="338"></td><td class="line-content">            d3.select(".slow").classed("current", true);</td></tr><tr><td class="line-number" value="339"></td><td class="line-content">			d3.select(".medium").classed("current", false);</td></tr><tr><td class="line-number" value="340"></td><td class="line-content">            d3.select(".fast").classed("current", false);</td></tr><tr><td class="line-number" value="341"></td><td class="line-content">        } else if (d3.select(this).attr("data-val") == "medium") {</td></tr><tr><td class="line-number" value="342"></td><td class="line-content">            d3.select(".slow").classed("current", false);</td></tr><tr><td class="line-number" value="343"></td><td class="line-content">			d3.select(".medium").classed("current", true);</td></tr><tr><td class="line-number" value="344"></td><td class="line-content">            d3.select(".fast").classed("current", false);</td></tr><tr><td class="line-number" value="345"></td><td class="line-content">        } </td></tr><tr><td class="line-number" value="346"></td><td class="line-content">		else {</td></tr><tr><td class="line-number" value="347"></td><td class="line-content">            d3.select(".slow").classed("current", false);</td></tr><tr><td class="line-number" value="348"></td><td class="line-content">			d3.select(".medium").classed("current", false);</td></tr><tr><td class="line-number" value="349"></td><td class="line-content">			d3.select(".fast").classed("current", true);</td></tr><tr><td class="line-number" value="350"></td><td class="line-content">        }</td></tr><tr><td class="line-number" value="351"></td><td class="line-content">		</td></tr><tr><td class="line-number" value="352"></td><td class="line-content">		USER_SPEED = d3.select(this).attr("data-val");</td></tr><tr><td class="line-number" value="353"></td><td class="line-content">    });</td></tr><tr><td class="line-number" value="354"></td><td class="line-content">}); // @end d3.tsv</td></tr><tr><td class="line-number" value="355"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="356"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="357"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="358"></td><td class="line-content">function color(activity) {</td></tr><tr><td class="line-number" value="359"></td><td class="line-content">	</td></tr><tr><td class="line-number" value="360"></td><td class="line-content">	var colorByActivity = {</td></tr><tr><td class="line-number" value="361"></td><td class="line-content">		"0": "#e0d400",</td></tr><tr><td class="line-number" value="362"></td><td class="line-content">		"1": "#1c8af9",</td></tr><tr><td class="line-number" value="363"></td><td class="line-content">		"2": "#51BC05",</td></tr><tr><td class="line-number" value="364"></td><td class="line-content">		"3": "#FF7F00",</td></tr><tr><td class="line-number" value="365"></td><td class="line-content">		"4": "#DB32A4",</td></tr><tr><td class="line-number" value="366"></td><td class="line-content">		"5": "#00CDF8",</td></tr><tr><td class="line-number" value="367"></td><td class="line-content">		"6": "#E63B60",</td></tr><tr><td class="line-number" value="368"></td><td class="line-content">		"7": "#8E5649",</td></tr><tr><td class="line-number" value="369"></td><td class="line-content">		"8": "#68c99e",</td></tr><tr><td class="line-number" value="370"></td><td class="line-content">		"9": "#a477c8",</td></tr><tr><td class="line-number" value="371"></td><td class="line-content">		"10": "#5C76EC",</td></tr><tr><td class="line-number" value="372"></td><td class="line-content">		"11": "#E773C3",</td></tr><tr><td class="line-number" value="373"></td><td class="line-content">		"12": "#799fd2",</td></tr><tr><td class="line-number" value="374"></td><td class="line-content">		"13": "#038a6c",</td></tr><tr><td class="line-number" value="375"></td><td class="line-content">		"14": "#cc87fa",</td></tr><tr><td class="line-number" value="376"></td><td class="line-content">		"15": "#ee8e76",</td></tr><tr><td class="line-number" value="377"></td><td class="line-content">		"16": "#bbbbbb",</td></tr><tr><td class="line-number" value="378"></td><td class="line-content">	}</td></tr><tr><td class="line-number" value="379"></td><td class="line-content">	</td></tr><tr><td class="line-number" value="380"></td><td class="line-content">	return colorByActivity[activity];</td></tr><tr><td class="line-number" value="381"></td><td class="line-content">	</td></tr><tr><td class="line-number" value="382"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="383"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="384"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="385"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="386"></td><td class="line-content">// Output readable percent based on count.</td></tr><tr><td class="line-number" value="387"></td><td class="line-content">function readablePercent(n) {</td></tr><tr><td class="line-number" value="388"></td><td class="line-content">	</td></tr><tr><td class="line-number" value="389"></td><td class="line-content">	var pct = 100 * n / 1000;</td></tr><tr><td class="line-number" value="390"></td><td class="line-content">	if (pct &lt; 1 &amp;&amp; pct &gt; 0) {</td></tr><tr><td class="line-number" value="391"></td><td class="line-content">		pct = "&lt;1%";</td></tr><tr><td class="line-number" value="392"></td><td class="line-content">	} else {</td></tr><tr><td class="line-number" value="393"></td><td class="line-content">		pct = Math.round(pct) + "%";</td></tr><tr><td class="line-number" value="394"></td><td class="line-content">	}</td></tr><tr><td class="line-number" value="395"></td><td class="line-content">	</td></tr><tr><td class="line-number" value="396"></td><td class="line-content">	return pct;</td></tr><tr><td class="line-number" value="397"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="398"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="399"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="400"></td><td class="line-content">// Minutes to time of day. Data is minutes from 4am.</td></tr><tr><td class="line-number" value="401"></td><td class="line-content">function minutesToTime(m) {</td></tr><tr><td class="line-number" value="402"></td><td class="line-content">	var minutes = (m + 4*60) % 1440;</td></tr><tr><td class="line-number" value="403"></td><td class="line-content">	var hh = Math.floor(minutes / 60);</td></tr><tr><td class="line-number" value="404"></td><td class="line-content">	var ampm;</td></tr><tr><td class="line-number" value="405"></td><td class="line-content">	if (hh &gt; 12) {</td></tr><tr><td class="line-number" value="406"></td><td class="line-content">		hh = hh - 12;</td></tr><tr><td class="line-number" value="407"></td><td class="line-content">		ampm = "pm";</td></tr><tr><td class="line-number" value="408"></td><td class="line-content">	} else if (hh == 12) {</td></tr><tr><td class="line-number" value="409"></td><td class="line-content">		ampm = "pm";</td></tr><tr><td class="line-number" value="410"></td><td class="line-content">	} else if (hh == 0) {</td></tr><tr><td class="line-number" value="411"></td><td class="line-content">		hh = 12;</td></tr><tr><td class="line-number" value="412"></td><td class="line-content">		ampm = "am";</td></tr><tr><td class="line-number" value="413"></td><td class="line-content">	} else {</td></tr><tr><td class="line-number" value="414"></td><td class="line-content">		ampm = "am";</td></tr><tr><td class="line-number" value="415"></td><td class="line-content">	}</td></tr><tr><td class="line-number" value="416"></td><td class="line-content">	var mm = minutes % 60;</td></tr><tr><td class="line-number" value="417"></td><td class="line-content">	if (mm &lt; 10) {</td></tr><tr><td class="line-number" value="418"></td><td class="line-content">		mm = "0" + mm;</td></tr><tr><td class="line-number" value="419"></td><td class="line-content">	}</td></tr><tr><td class="line-number" value="420"></td><td class="line-content">	</td></tr><tr><td class="line-number" value="421"></td><td class="line-content">	return hh + ":" + mm + ampm</td></tr><tr><td class="line-number" value="422"></td><td class="line-content">}</td></tr><tr><td class="line-number" value="423"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="424"></td><td class="line-content"><br></td></tr><tr><td class="line-number" value="425"></td><td class="line-content"><span class="html-tag">&lt;/script&gt;</span><span class="html-end-of-file"></span></td></tr></tbody></table></body></html>